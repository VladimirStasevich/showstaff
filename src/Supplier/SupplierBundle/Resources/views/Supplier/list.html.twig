{% extends 'SupplierBundle::base.html.twig' %}

{% block body %}
<div  class="row">
	<div class="span12">
		<h2>Suppliers in the Company "{{ company.name }}</h2>
		<table class="table table-bordered table-striped" id="supplier_list">
		 <thead>
		  <tr>
			<th>Название
				<a href="#" class="sort"><i class="icon-arrow-up"></i></a>
			</th>
			<th></th>
		  </tr>
		  <tr id="add_row">
			<th colspan="2" class="add">
				<a href="#" id="add_supplier" class="create btn btn-small">Add new Supplier <i class="icon-plus-sign"></i></a>
				<p class="form-inline hide" id="form_add">
					<input name="name_add" type="text" class="input name_add">
					<button class="add_supplier btn btn-mini btn-success">add</button>
				</p>
			</th>
		  </tr>
		 </thead>
		</table>
		<script src="/js/supplier.js"></script>
		<script type="text/javascript">
			// Collection supplier
			var Suppliers = Backbone.Collection.extend({
			  
			  model: SupplierModel,
			  
			  url: '/company/{{ company.id }}/supplier',
			  
			  initialize: function(){
				  this.bind('add', this.addSupplier);
			  },
			  
			  addSupplier: function(supplier){
				supplier.save({wait: true});
			  },
			  
			});
			
			var suppliers = new Suppliers; // init collection

			var view_suppliers = new ViewSuppliers({collection: suppliers}); // initialize view

			suppliers.comparator = function(supplier) {
			  return supplier.get("name");
			};

			$('#supplier_list').append(view_suppliers.render().el); // add template

			$('#preloader').width($('#add_row').width());
			$('#preloader').height($('#add_row').height());
			var p = $('#add_row').position();
			$('#preloader').css({'left':p.left, 'top': p.top});
			$('#preloader').fadeIn('fast');

			suppliers.reset({{ suppliers_json|raw }});

		</script>
	</div>
</div>
{% endblock %}
